# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

**Tech Stack**: TypeScript, React 18, Vite, React Router v6
**Database**: N/A (frontend only â€” communicates with Movie API at localhost:8080)
**Testing**: Vitest + React Testing Library
**Validation**: Zod (client-side form validation)
**CI/CD**: GitHub Actions
**Security**: DOMPurify (XSS), JWT in-memory only, CSRF via X-XSRF-TOKEN, Zod allowlist validation

## Security Framework

This project follows the MaintainabilityAI security-first SDLC framework:
- OWASP Top 10 prompt packs for security guidance
- STRIDE threat modeling for design reviews
- Fitness functions for automated quality gates
- Golden Rules of Vibe Coding for governance

## Development Commands

```bash
# Install dependencies (use ci for reproducible builds)
npm ci

# Run tests with coverage
npm test

# Watch mode
npm run test:watch

# Lint (must pass with zero warnings)
npm run lint

# Type check
npm run type-check

# Build
npm run build

# Development server (localhost:3000)
npm run dev
```

## Path Aliases

All imports should use path aliases configured in `tsconfig.json` and `vite.config.ts`:
- `@/components/*` â†’ `src/components/*`
- `@/services/*` â†’ `src/services/*`
- `@/pages/*` â†’ `src/pages/*`
- `@/types/*` â†’ `src/types/*`
- `@/utils/*` â†’ `src/utils/*`
- `@/context/*` â†’ `src/context/*`
- `@/config/*` â†’ `src/config/*`

## Security Conventions

### JWT Handling (OWASP A07)
- **NEVER** store JWT in `localStorage` or `sessionStorage`
- JWT access token lives in React state (in-memory) only
- Refresh token is an httpOnly cookie managed by the API server

### XSS Prevention (THR-006, OWASP A03)
- All API response text MUST be sanitized via `sanitizeText()` before rendering
- User-generated HTML uses `sanitizeHtml()` â€” never raw `dangerouslySetInnerHTML`

### CSRF Protection (OWASP A01)
- `apiFetch()` automatically reads `XSRF-TOKEN` cookie â†’ `X-XSRF-TOKEN` header on mutating requests

### CDN URL Validation (OWASP A10)
- All image src attributes must pass through `getCdnUrlOrPlaceholder()`
- `javascript:` and `data:` URIs blocked in all href attributes

### Audit Logging (THR-003)
- Log actions via `auditLogger` â€” emails are SHA-256 hashed, passwords never logged

## Branch Protection Rules

The `main` branch requires:
1. All CI jobs pass (lint, type-check, test â‰¥80% coverage, npm audit, build)
2. At least 1 reviewer approval before merging
3. No force pushes to `main`

## Security Workflow

1. **Be specific** â€” Define intent and security constraints in prompts
2. **Trust but verify** â€” Never merge AI-generated code without understanding it
3. **Treat AI like a junior dev** â€” Review, guide, and validate suggestions
4. **Isolate AI changes** â€” Use separate commits/PRs; label AI-assisted changes
5. **Document rationale** â€” Explain the "why" in code comments and commit messages
6. **Share winning prompts** â€” Capture effective prompts in `/prompts` for reuse

## Commit Labeling

Always use the AI disclosure label in commits:
```bash
git commit -m "feat: Add user authentication

ðŸ¤– AI-assisted with [tool] using MaintainabilityAI prompt packs"
```

---

Generated by MaintainabilityAI VS Code Extension
